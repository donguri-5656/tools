<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>単位変換ツール</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 40px 20px;
            background-color: #eef2f7;
            color: #333;
        }

        .converter-container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
        }

        h1 {
            text-align: center;
            color: #1a5c92;
            margin-bottom: 30px;
            border-bottom: 3px solid #1a5c92;
            padding-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            padding: 15px;
            background-color: #f7f9fb;
            border-radius: 8px;
        }

        .input-group {
            flex-grow: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }

        /* 検索とカテゴリ選択のためのコンテナ */
        .category-search-container {
            position: relative; 
        }

        /* 検索入力フィールド */
        #categorySearch {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }

        /* 提案リストのスタイル */
        #categorySuggestions {
            position: absolute;
            z-index: 10;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-top: none;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 0 0 6px 6px;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #categorySuggestions li {
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #categorySuggestions li:hover, #categorySuggestions li.selected {
            background-color: #e0eaff;
            font-weight: bold;
        }
        
        /* 変換元単位と値の入力フィールド */
        input[type="number"], select {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }

        /* 結果テーブルのスタイル */
        .result-section {
            margin-top: 30px;
        }

        h2 {
            color: #007bff;
            margin-bottom: 15px;
            border-left: 5px solid #007bff;
            padding-left: 10px;
        }

        #resultTable {
            width: 100%;
            border-collapse: collapse;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        #resultTable th, #resultTable td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        #resultTable th {
            background-color: #1a5c92;
            color: white;
            font-weight: 700;
        }
        
        #resultTable th:nth-child(2), #resultTable td:nth-child(2) {
            text-align: right; 
            font-weight: bold;
            color: #0056b3;
        }

        #resultTable tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>

<div class="converter-container">
    <h1>単位変換ツール</h1>

    <div class="controls">
        <div class="input-group">
            <label for="categorySearch">カテゴリ検索:</label>
            <div class="category-search-container" id="categorySearchArea">
                <input type="text" id="categorySearch" placeholder="カテゴリ名を入力して検索..." autocomplete="off">
                <ul id="categorySuggestions" style="display:none;"></ul>
            </div>
            <input type="hidden" id="selectedCategoryKey" value="">
        </div>

        <div class="input-group">
            <label for="inputValue">値:</label>
            <input type="number" id="inputValue" value="1" placeholder="変換したい値を入力" oninput="convertUnit()">
        </div>

        <div class="input-group">
            <label for="fromUnit">変換元単位:</label>
            <select id="fromUnit" onchange="convertUnit()"></select>
        </div>
    </div>

    <div class="result-section">
        <h2 id="resultTitle">結果</h2>
        <table id="resultTable">
            <thead>
                <tr>
                    <th>単位名</th>
                    <th>換算値</th>
                    <th>単位</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>

</div>

<script>
    // --- JavaScriptセクション ---

    // 単位とその変換基準 (基本単位をさらに増強)
    const units = {
        // --- 幾何学 ---
        "長さ": { 
            // SI/メートル法 (ベース: m)
            pm: { name: "ピコメートル", toBase: 1e-12, system: "SI", display: "pm" },
            nm: { name: "ナノメートル", toBase: 1e-9, system: "SI", display: "nm" },
            μm: { name: "マイクロメートル", toBase: 1e-6, system: "SI", display: "μm" },
            mm: { name: "ミリメートル", toBase: 1e-3, system: "SI", display: "mm" },
            cm: { name: "センチメートル", toBase: 1e-2, system: "SI", display: "cm" },
            m: { name: "メートル", toBase: 1, system: "SI", display: "m" },
            km: { name: "キロメートル", toBase: 1e3, system: "SI", display: "km" },
            // ヤード・ポンド法
            mil: { name: "ミル", toBase: 2.54e-5, system: "ヤード・ポンド法", display: "mil" },
            in: { name: "インチ", toBase: 0.0254, system: "ヤード・ポンド法", display: "in" },
            ft: { name: "フィート", toBase: 0.3048, system: "ヤード・ポンド法", display: "ft" },
            yd: { name: "ヤード", toBase: 0.9144, system: "ヤード・ポンド法", display: "yd" },
            mi: { name: "マイル (土地)", toBase: 1609.344, system: "ヤード・ポンド法", display: "mi" },
            // 尺貫法
            分: { name: "分(ブ)", toBase: 0.0030303, system: "尺貫法", display: "分" },
            寸: { name: "寸(スン)", toBase: 0.030303, system: "尺貫法", display: "寸" },
            尺: { name: "尺(シャク)", toBase: 0.30303, system: "尺貫法", display: "尺" },
            // 天文・航海
            海里: { name: "海里", toBase: 1852, system: "航海", display: "海里" },
            AU: { name: "天文単位", toBase: 149597870700, system: "天文", display: "AU" },
            ly: { name: "光年", toBase: 9.46073e15, system: "天文", display: "ly" },
            pc: { name: "パーセク", toBase: 3.0856776e16, system: "天文", display: "pc" },
        },
        "面積": { 
            // SI/メートル法 (ベース: m²)
            mm2: { name: "平方ミリメートル", toBase: 1e-6, system: "SI", display: "mm²" },
            cm2: { name: "平方センチメートル", toBase: 1e-4, system: "SI", display: "cm²" },
            m2: { name: "平方メートル", toBase: 1, system: "SI", display: "m²" },
            a: { name: "アール", toBase: 100, system: "SI", display: "a" },
            ha: { name: "ヘクタール", toBase: 10000, system: "SI", display: "ha" },
            km2: { name: "平方キロメートル", toBase: 1e6, system: "SI", display: "km²" },
            // ヤード・ポンド法
            ft2: { name: "平方フィート", toBase: 0.092903, system: "ヤード・ポンド法", display: "ft²" },
            yd2: { name: "平方ヤード", toBase: 0.836127, system: "ヤード・ポンド法", display: "yd²" },
            ac: { name: "エーカー", toBase: 4046.86, system: "ヤード・ポンド法", display: "ac" },
            mi2: { name: "平方マイル", toBase: 2589988, system: "ヤード・ポンド法", display: "mi²" },
            // 尺貫法
            坪: { name: "坪", toBase: 3.305785, system: "尺貫法", display: "坪" },
            反: { name: "反", toBase: 991.7355, system: "尺貫法", display: "反" },
            町歩: { name: "町歩", toBase: 9917.355, system: "尺貫法", display: "町歩" },
        },
        "体積": { 
            // SI/メートル法 (ベース: m³)
            cm3: { name: "立方センチメートル", toBase: 1e-6, system: "SI", display: "cm³" },
            mL: { name: "ミリリットル", toBase: 1e-6, system: "SI", display: "mL" },
            L: { name: "リットル", toBase: 1e-3, system: "SI", display: "L" },
            m3: { name: "立方メートル", toBase: 1, system: "SI", display: "m³" },
            // ヤード・ポンド法
            floz_us: { name: "液量オンス (US)", toBase: 2.95735e-5, system: "ヤード・ポンド法", display: "fl oz (US)" },
            qt_us: { name: "クォート (US液量)", toBase: 0.000946353, system: "ヤード・ポンド法", display: "qt (US)" },
            gal_us: { name: "ガロン (US液量)", toBase: 0.00378541, system: "ヤード・ポンド法", display: "gal (US)" },
            ft3: { name: "立方フィート", toBase: 0.0283168, system: "ヤード・ポンド法", display: "ft³" },
            yd3: { name: "立方ヤード", toBase: 0.764555, system: "ヤード・ポンド法", display: "yd³" },
            bbl: { name: "バレル (石油)", toBase: 0.158987, system: "ヤード・ポンド法", display: "bbl" },
            // 尺貫法
            合: { name: "合", toBase: 0.000180391, system: "尺貫法", display: "合" },
            升: { name: "升", toBase: 0.00180391, system: "尺貫法", display: "升" },
            石: { name: "石", toBase: 0.180391, system: "尺貫法", display: "石" },
        },
        // --- 物理量 ---
        "質量": { 
            // SI/メートル法 (ベース: kg)
            μg: { name: "マイクログラム", toBase: 1e-9, system: "SI", display: "μg" },
            mg: { name: "ミリグラム", toBase: 1e-6, system: "SI", display: "mg" },
            g: { name: "グラム", toBase: 1e-3, system: "SI", display: "g" },
            kg: { name: "キログラム", toBase: 1, system: "SI", display: "kg" },
            t: { name: "トン (metric)", toBase: 1000, system: "SI", display: "t" },
            // ヤード・ポンド法
            oz: { name: "オンス (常衡)", toBase: 0.0283495, system: "ヤード・ポンド法", display: "oz" },
            lb: { name: "ポンド (常衡)", toBase: 0.453592, system: "ヤード・ポンド法", display: "lb" },
            st: { name: "ストーン", toBase: 6.35029, system: "ヤード・ポンド法", display: "st" },
            ton_us: { name: "ショートトン (US)", toBase: 907.185, system: "ヤード・ポンド法", display: "ton (US)" },
            // 尺貫法
            匁: { name: "匁(モンメ)", toBase: 0.00375, system: "尺貫法", display: "匁" },
            貫: { name: "貫", toBase: 3.75, system: "尺貫法", display: "貫" },
        },
        "時間": { 
            // SI/その他 (ベース: s)
            ns: { name: "ナノ秒", toBase: 1e-9, system: "SI", display: "ns" },
            μs: { name: "マイクロ秒", toBase: 1e-6, system: "SI", display: "μs" },
            ms: { name: "ミリ秒", toBase: 1e-3, system: "SI", display: "ms" },
            s: { name: "秒", toBase: 1, system: "SI", display: "s" },
            min: { name: "分", toBase: 60, system: "その他", display: "min" },
            hr: { name: "時", toBase: 3600, system: "その他", display: "h" },
            day: { name: "日", toBase: 86400, system: "その他", display: "day" },
            week: { name: "週", toBase: 604800, system: "その他", display: "week" },
            year: { name: "年 (平年)", toBase: 31536000, system: "その他", display: "year" },
            decade: { name: "ディケード", toBase: 315360000, system: "その他", display: "decade" },
            century: { name: "世紀", toBase: 3153600000, system: "その他", display: "century" },
        },
        "速さ": { 
            // SI/メートル法 (ベース: m/s)
            ms: { name: "メートル毎秒", toBase: 1, system: "SI", display: "m/s" },
            cms: { name: "センチメートル毎秒", toBase: 0.01, system: "CGS", display: "cm/s" },
            kmh: { name: "キロメートル毎時", toBase: 1 / 3.6, system: "SI", display: "km/h" },
            // ヤード・ポンド法/航海
            fps: { name: "フィート毎秒", toBase: 0.3048, system: "ヤード・ポンド法", display: "ft/s" },
            mph: { name: "マイル毎時", toBase: 0.44704, system: "ヤード・ポンド法", display: "mph" },
            knot: { name: "ノット", toBase: 0.514444, system: "航海", display: "kn" },
            mach: { name: "マッハ", toBase: 340.29, system: "その他", display: "Mach" }, // 20度Cでの大気中
        },
        "力": { 
            // SI/その他 (ベース: N)
            mN: { name: "ミリニュートン", toBase: 1e-3, system: "SI", display: "mN" },
            N: { name: "ニュートン", toBase: 1, system: "SI", display: "N" },
            kN: { name: "キロニュートン", toBase: 1000, system: "SI", display: "kN" },
            MN: { name: "メガニュートン", toBase: 1e6, system: "SI", display: "MN" },
            dyn: { name: "ダイン", toBase: 1e-5, system: "CGS", display: "dyn" },
            kgf: { name: "重量キログラム", toBase: 9.80665, system: "メートル法", display: "kgf" },
            lbf: { name: "重量ポンド", toBase: 4.44822, system: "ヤード・ポンド法", display: "lbf" },
        },
        "エネルギー": { 
            // SI/その他 (ベース: J)
            mJ: { name: "ミリジュール", toBase: 1e-3, system: "SI", display: "mJ" },
            J: { name: "ジュール", toBase: 1, system: "SI", display: "J" },
            kJ: { name: "キロジュール", toBase: 1000, system: "SI", display: "kJ" },
            MJ: { name: "メガジュール", toBase: 1e6, system: "SI", display: "MJ" },
            erg: { name: "エルグ", toBase: 1e-7, system: "CGS", display: "erg" },
            cal_it: { name: "カロリー (IT)", toBase: 4.1868, system: "その他", display: "cal" },
            kcal: { name: "キロカロリー", toBase: 4184, system: "その他", display: "kcal" },
            Btu: { name: "英国熱量単位", toBase: 1055.06, system: "ヤード・ポンド法", display: "BTU" },
            eV: { name: "電子ボルト", toBase: 1.60218e-19, system: "物理", display: "eV" },
            kWh: { name: "キロワット時", toBase: 3600000, system: "電気", display: "kWh" },
        },
        "圧力": { 
            // SI/その他 (ベース: Pa)
            Pa: { name: "パスカル", toBase: 1, system: "SI", display: "Pa" },
            hPa: { name: "ヘクトパスカル", toBase: 100, system: "SI", display: "hPa" },
            kPa: { name: "キロパスカル", toBase: 1000, system: "SI", display: "kPa" },
            MPa: { name: "メガパスカル", toBase: 1e6, system: "SI", display: "MPa" },
            bar: { name: "バール", toBase: 100000, system: "その他", display: "bar" },
            mbar: { name: "ミリバール", toBase: 100, system: "その他", display: "mbar" },
            atm: { name: "気圧 (標準)", toBase: 101325, system: "その他", display: "atm" },
            torr: { name: "トル", toBase: 133.322, system: "その他", display: "Torr" },
            psi: { name: "重量ポンド毎平方インチ", toBase: 6894.76, system: "ヤード・ポンド法", display: "psi" },
        },
        "電力": { 
            // SI/その他 (ベース: W)
            mW: { name: "ミリワット", toBase: 1e-3, system: "SI", display: "mW" },
            W: { name: "ワット", toBase: 1, system: "SI", display: "W" },
            kW: { name: "キロワット", toBase: 1000, system: "SI", display: "kW" },
            MW: { name: "メガワット", toBase: 1e6, system: "SI", display: "MW" },
            hp_imp: { name: "馬力 (UK)", toBase: 745.7, system: "ヤード・ポンド法", display: "hp (UK)" },
            hp_met: { name: "馬力 (メートル法)", toBase: 735.49875, system: "メートル法", display: "PS" },
        },
        "密度": { 
            // SI/CGS (ベース: kg/m³)
            kgm3: { name: "キログラム毎立方メートル", toBase: 1, system: "SI", display: "kg/m³" },
            gcm3: { name: "グラム毎立方センチメートル", toBase: 1000, system: "CGS", display: "g/cm³" },
            lbft3: { name: "ポンド毎立方フィート", toBase: 16.0185, system: "ヤード・ポンド法", display: "lb/ft³" },
        },
        "トルク": { 
            // SI/ヤード・ポンド法 (ベース: N⋅m)
            mNm: { name: "ミリニュートンメートル", toBase: 1e-3, system: "SI", display: "mN⋅m" },
            Nm: { name: "ニュートンメートル", toBase: 1, system: "SI", display: "N⋅m" },
            kNm: { name: "キロニュートンメートル", toBase: 1000, system: "SI", display: "kN⋅m" },
            kgf_m: { name: "重量キログラムメートル", toBase: 9.80665, system: "メートル法", display: "kgf⋅m" },
            lbf_ft: { name: "重量ポンドフィート", toBase: 1.355818, system: "ヤード・ポンド法", display: "lbf⋅ft" },
        },
        // --- 温度 (特殊変換) ---
        "温度": { 
            C: { name: "セルシウス度", system: "SI", display: "°C" },
            F: { name: "ファーレンハイト度", system: "ヤード・ポンド法", display: "°F" },
            K: { name: "ケルビン", system: "SI", display: "K" },
            R: { name: "ランキン度", system: "ヤード・ポンド法", display: "°R" },
        },
        // --- 電気・磁気 ---
        "電荷": { 
            // SI/電気 (ベース: C)
            C: { name: "クーロン", toBase: 1, system: "SI", display: "C" },
            mC: { name: "ミリスクーロン", toBase: 1e-3, system: "SI", display: "mC" },
            Ah: { name: "アンペア時", toBase: 3600, system: "電気", display: "Ah" },
        },
        "電流": { 
            A: { name: "アンペア", toBase: 1, system: "SI", display: "A" },
            mA: { name: "ミリアンペア", toBase: 1e-3, system: "SI", display: "mA" },
            kA: { name: "キロアンペア", toBase: 1000, system: "SI", display: "kA" },
        },
        "電圧": { 
            V: { name: "ボルト", toBase: 1, system: "SI", display: "V" },
            mV: { name: "ミリボルト", toBase: 1e-3, system: "SI", display: "mV" },
            kV: { name: "キロボルト", toBase: 1000, system: "SI", display: "kV" },
        },
        "抵抗": { 
            ohm: { name: "オーム", toBase: 1, system: "SI", display: "Ω" },
            mOhm: { name: "ミリオーム", toBase: 1e-3, system: "SI", display: "mΩ" },
            kOhm: { name: "キロオーム", toBase: 1000, system: "SI", display: "kΩ" },
            MOhm: { name: "メガオーム", toBase: 1e6, system: "SI", display: "MΩ" },
        },
        "インダクタンス": { 
            H: { name: "ヘンリー", toBase: 1, system: "SI", display: "H" },
            mH: { name: "ミリヘンリー", toBase: 1e-3, system: "SI", display: "mH" },
            μH: { name: "マイクロヘンリー", toBase: 1e-6, system: "SI", display: "μH" },
        },
        "磁束": { 
            Wb: { name: "ウェーバ", toBase: 1, system: "SI", display: "Wb" },
            mWb: { name: "ミリウェーバ", toBase: 1e-3, system: "SI", display: "mWb" },
            Mx: { name: "マクスウェル", toBase: 1e-8, system: "CGS", display: "Mx" },
        },
        "磁束密度": { 
            T: { name: "テスラ", toBase: 1, system: "SI", display: "T" },
            mT: { name: "ミリテスラ", toBase: 1e-3, system: "SI", display: "mT" },
            μT: { name: "マイクロテスラ", toBase: 1e-6, system: "SI", display: "μT" },
            G: { name: "ガウス", toBase: 1e-4, system: "CGS", display: "G" },
        },
        // --- 光・放射線 ---
        "光度": { 
            cd: { name: "カンデラ", toBase: 1, system: "SI", display: "cd" },
            kcd: { name: "キロカンデラ", toBase: 1000, system: "SI", display: "kcd" },
        },
        "照度": { 
            lx: { name: "ルクス", toBase: 1, system: "SI", display: "lx" },
            klx: { name: "キルルクス", toBase: 1000, system: "SI", display: "klx" },
            foot_candle: { name: "フート・カンデラ", toBase: 10.76391, system: "ヤード・ポンド法", display: "fc" },
        },
        "放射能": { 
            Bq: { name: "ベクレル", toBase: 1, system: "SI", display: "Bq" },
            kBq: { name: "キロベクレル", toBase: 1000, system: "SI", display: "kBq" },
            MBq: { name: "メガベクレル", toBase: 1e6, system: "SI", display: "MBq" },
            Ci: { name: "キュリー", toBase: 3.7e10, system: "その他", display: "Ci" },
        },
        // --- データ・濃度・流量 ---
        "データサイズ(JEDEC)": { 
            bit: { name: "ビット", toBase: 1 / 8, system: "JEDEC", display: "bit" },
            B: { name: "バイト", toBase: 1, system: "JEDEC", display: "B" },
            KB: { name: "キロバイト", toBase: 1024, system: "JEDEC", display: "KB" },
            MB: { name: "メガバイト", toBase: 1024 ** 2, system: "JEDEC", display: "MB" },
            GB: { name: "ギガバイト", toBase: 1024 ** 3, system: "JEDEC", display: "GB" },
            TB: { name: "テラバイト", toBase: 1024 ** 4, system: "JEDEC", display: "TB" },
            PB: { name: "ペタバイト", toBase: 1024 ** 5, system: "JEDEC", display: "PB" },
        },
        "流量(体積)": { 
            m3s: { name: "立方メートル毎秒", toBase: 1, system: "SI", display: "m³/s" },
            Lmin: { name: "リットル毎分", toBase: 1e-3 / 60, system: "SI", display: "L/min" },
            ft3s: { name: "立方フィート毎秒", toBase: 0.0283168, system: "ヤード・ポンド法", display: "ft³/s" },
            galmin: { name: "ガロン毎分 (US)", toBase: 0.00378541 / 60, system: "ヤード・ポンド法", display: "gal/min" },
        },
        "モル濃度": { 
            molm3: { name: "モル毎立方メートル", toBase: 1, system: "SI", display: "mol/m³" },
            molL: { name: "モル毎リットル", toBase: 1000, system: "SI", display: "mol/L" },
            M: { name: "モル濃度", toBase: 1000, system: "SI", display: "M" },
            mM: { name: "ミリモル濃度", toBase: 1, system: "SI", display: "mM" },
        },
        // --- その他基礎単位 ---
        "角度": { 
            rad: { name: "ラジアン", toBase: 1, system: "SI", display: "rad" },
            mrad: { name: "ミリラジアン", toBase: 1e-3, system: "SI", display: "mrad" },
            deg: { name: "度", toBase: Math.PI / 180, system: "その他", display: "°" },
            grad: { name: "グラジアン", toBase: Math.PI / 200, system: "その他", display: "grad" },
            arcsec: { name: "秒 (角)", toBase: Math.PI / 648000, system: "その他", display: "''" },
        },
        "周波数": { 
            Hz: { name: "ヘルツ", toBase: 1, system: "SI", display: "Hz" },
            kHz: { name: "キロヘルツ", toBase: 1000, system: "SI", display: "kHz" },
            MHz: { name: "メガヘルツ", toBase: 1e6, system: "SI", display: "MHz" },
            GHz: { name: "ギガヘルツ", toBase: 1e9, system: "SI", display: "GHz" },
        },
        "物質量": { 
            mol: { name: "モル", toBase: 1, system: "SI", display: "mol" },
            kmol: { name: "キロモル", toBase: 1000, system: "SI", display: "kmol" },
            mmol: { name: "ミリモル", toBase: 1e-3, system: "SI", display: "mmol" },
        },
        "動粘度": { 
            Pas: { name: "パスカル秒", toBase: 1, system: "SI", display: "Pa⋅s" },
            mPas: { name: "ミリパスカル秒", toBase: 1e-3, system: "SI", display: "mPa⋅s" },
            poise: { name: "ポアズ", toBase: 0.1, system: "CGS", display: "P" },
            cP: { name: "センチポアズ", toBase: 0.001, system: "CGS", display: "cP" },
        },
        "表面張力": { 
            Nm: { name: "ニュートン毎メートル", toBase: 1, system: "SI", display: "N/m" },
            dyn_cm: { name: "ダイン毎センチメートル", toBase: 1e-3, system: "CGS", display: "dyn/cm" },
        },
        "運動量": { 
            kgms: { name: "キログラムメートル毎秒", toBase: 1, system: "SI", display: "kg⋅m/s" },
            gs: { name: "グラムセンチメートル毎秒", toBase: 1e-5, system: "CGS", display: "g⋅cm/s" },
        },
        "インピーダンス": { 
            ohm: { name: "オーム", toBase: 1, system: "SI", display: "Ω" },
            mOhm: { name: "ミリオーム", toBase: 1e-3, system: "SI", display: "mΩ" },
        },
        "コンダクタンス": { 
            S: { name: "ジーメンス", toBase: 1, system: "SI", display: "S" },
            mS: { name: "ミリジーメンス", toBase: 1e-3, system: "SI", display: "mS" },
            kS: { name: "キロジーメンス", toBase: 1000, system: "SI", display: "kS" },
        },
        "静電容量": { 
            F: { name: "ファラド", toBase: 1, system: "SI", display: "F" },
            μF: { name: "マイクロファラド", toBase: 1e-6, system: "SI", display: "μF" },
            nF: { name: "ナノファラド", toBase: 1e-9, system: "SI", display: "nF" },
            pF: { name: "ピコファラド", toBase: 1e-12, system: "SI", display: "pF" },
        },
    };

    const categorySearch = document.getElementById('categorySearch');
    const categorySuggestions = document.getElementById('categorySuggestions');
    const selectedCategoryKey = document.getElementById('selectedCategoryKey');
    const fromUnitSelect = document.getElementById('fromUnit');
    const inputValue = document.getElementById('inputValue');
    const resultTableBody = document.querySelector('#resultTable tbody');
    const resultTitle = document.getElementById('resultTitle');
    const categorySearchArea = document.getElementById('categorySearchArea');

    const allCategories = Object.keys(units);
    let currentSelectedSuggestionIndex = -1; 

    // ----------------------------------------------------
    // 1. iPad/タッチデバイス最適化: ダブルタップズーム防止
    // ----------------------------------------------------
    document.addEventListener('dblclick', function(e) {
      e.preventDefault();
    }, { passive: false });
    
    // ----------------------------------------------------
    // 2. UI制御関数
    // ----------------------------------------------------

    function showSuggestions(list) {
        categorySuggestions.innerHTML = '';
        currentSelectedSuggestionIndex = -1;
        
        if (list.length === 0) {
            categorySuggestions.style.display = 'none';
            return;
        }

        list.forEach((categoryKey, index) => {
            const li = document.createElement('li');
            li.textContent = categoryKey;
            li.dataset.categoryKey = categoryKey;
            
            li.addEventListener('click', (e) => {
                e.stopPropagation(); 
                selectCategory(categoryKey);
            });
            
            categorySuggestions.appendChild(li);
        });
        
        categorySuggestions.style.display = 'block';
    }

    function selectCategory(categoryKey) {
        categorySearch.value = categoryKey; 
        selectedCategoryKey.value = categoryKey; 
        categorySuggestions.style.display = 'none';
        resetConversion(); 
    }
    
    // ----------------------------------------------------
    // 3. カテゴリ検索/リスト制御ロジック
    // ----------------------------------------------------

    categorySearch.addEventListener('input', () => {
        const filterText = categorySearch.value.toLowerCase();
        const filtered = allCategories.filter(key => key.toLowerCase().includes(filterText));
        showSuggestions(filtered);
    });

    categorySearch.addEventListener('focus', () => {
         const filterText = categorySearch.value.toLowerCase();
         const filtered = allCategories.filter(key => key.toLowerCase().includes(filterText));
         showSuggestions(filtered);
    });
    
    // 外部タップでリストを閉じる
    document.addEventListener('click', function(e) {
        const isClickInside = categorySearchArea.contains(e.target);
        const isListOpen = categorySuggestions.style.display !== 'none';

        if (!isClickInside && isListOpen) {
            categorySuggestions.style.display = 'none';
        }
    });

    // キーボード操作のサポート
    categorySearch.addEventListener('keydown', (e) => {
        const items = Array.from(categorySuggestions.children);
        if (items.length === 0) return;

        if (e.key === 'ArrowDown') {
            e.preventDefault();
            currentSelectedSuggestionIndex = (currentSelectedSuggestionIndex + 1) % items.length;
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            currentSelectedSuggestionIndex = (currentSelectedSuggestionIndex - 1 + items.length) % items.length;
        } else if (e.key === 'Enter') {
            e.preventDefault();
            const targetIndex = currentSelectedSuggestionIndex !== -1 ? currentSelectedSuggestionIndex : 0; 
            if (items[targetIndex]) {
                const selectedKey = items[targetIndex].dataset.categoryKey;
                selectCategory(selectedKey);
                categorySearch.blur(); 
            }
            return;
        } else {
            return;
        }

        items.forEach((item, index) => {
            item.classList.toggle('selected', index === currentSelectedSuggestionIndex);
            if (index === currentSelectedSuggestionIndex) {
                 item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        });
    });


    // ----------------------------------------------------
    // 4. 変換ロジック
    // ----------------------------------------------------

    function getGroupedUnits(type) {
        const currentUnits = units[type];
        const grouped = {};
        for (const key in currentUnits) {
            const unit = currentUnits[key];
            const system = unit.system || "その他";
            if (!grouped[system]) {
                grouped[system] = [];
            }
            grouped[system].push({ key: key, name: unit.name, display: unit.display });
        }
        return grouped;
    }

    function populateUnits() {
        const type = selectedCategoryKey.value;
        const currentUnits = units[type];

        fromUnitSelect.innerHTML = '';
        if (!currentUnits) {
             fromUnitSelect.innerHTML = '<option value="">単位を選択</option>';
             return;
        }

        for (const key in currentUnits) {
            const unit = currentUnits[key];
            const option = `<option value="${key}">${unit.name} (${unit.display || key})</option>`;
            fromUnitSelect.insertAdjacentHTML('beforeend', option);
        }

        fromUnitSelect.value = Object.keys(currentUnits)[0];
    }

    function convertTemperature(value, fromKey, toKey) {
        let baseC; 
        if (fromKey === 'C') baseC = value;
        else if (fromKey === 'F') baseC = (value - 32) * 5 / 9;
        else if (fromKey === 'K') baseC = value - 273.15;
        else if (fromKey === 'R') baseC = (value - 491.67) * 5 / 9;

        if (toKey === 'C') return baseC;
        else if (toKey === 'F') return (baseC * 9 / 5) + 32;
        else if (toKey === 'K') return baseC + 273.15;
        else if (toKey === 'R') return (baseC + 273.15) * 9 / 5;
    }

    function convertUnit() {
        const type = selectedCategoryKey.value;
        const value = parseFloat(inputValue.value);
        const fromUnitKey = fromUnitSelect.value;
        const currentUnits = units[type];

        if (isNaN(value) || !type || !currentUnits || !currentUnits[fromUnitKey]) {
            resultTableBody.innerHTML = `<tr><td colspan="3" style="text-align:center; color:red;">変換を行うには、カテゴリと有効な単位を選択し、値を入力してください。</td></tr>`;
            resultTitle.textContent = `変換結果`;
            return;
        }

        resultTableBody.innerHTML = ''; 
        resultTitle.textContent = `${value} ${currentUnits[fromUnitKey].name} (${currentUnits[fromUnitKey].display || fromUnitKey}) の変換結果`;
        
        const groupedUnits = getGroupedUnits(type);
        
        for (const system in groupedUnits) {
            // 単位系の名前をシンプルに表示
            resultTableBody.insertAdjacentHTML('beforeend', 
                `<tr><td colspan="3" style="background-color:#e0eaff; font-weight:bold; border-top:2px solid #1a5c92;">${system}</td></tr>`
            );

            for (const unit of groupedUnits[system]) {
                const toUnitKey = unit.key;
                let result;

                if (type === '温度') {
                    result = convertTemperature(value, fromUnitKey, toUnitKey);
                } else {
                    const baseValue = value * currentUnits[fromUnitKey].toBase;
                    result = baseValue / currentUnits[toUnitKey].toBase;
                }

                // 結果の精度調整
                let displayResult;
                if (result === 0) {
                    displayResult = 0;
                } else {
                    const absResult = Math.abs(result);
                    // 非常に大きい、または非常に小さい値は指数表記
                    if (absResult > 1e12 || (absResult < 1e-6 && absResult !== 0)) {
                        displayResult = result.toExponential(4);
                    } 
                    // ほぼ整数の場合は四捨五入して整数表示
                    else if (Math.abs(result - Math.round(result)) < 1e-8) {
                        displayResult = Math.round(result);
                    } 
                    // それ以外は小数点以下6桁表示
                    else {
                        displayResult = result.toFixed(6);
                    }
                }
                
                const unitDisplay = (unit.display || toUnitKey);
                
                const unitInfo = currentUnits[toUnitKey];
                const resultRow = `
                    <tr>
                        <td>${unitInfo.name}</td>
                        <td>${displayResult}</td>
                        <td>${unitDisplay}</td>
                    </tr>
                `;
                resultTableBody.insertAdjacentHTML('beforeend', resultRow);
            }
        }
    }

    function resetConversion() {
        populateUnits();
        convertUnit();
    }

    // 初期化処理
    document.addEventListener('DOMContentLoaded', () => {
        // 初期状態はカテゴリ未選択、未入力
        categorySearch.value = ""; 
        selectedCategoryKey.value = "";
        
        convertUnit(); 
    });

</script>

</body>
</html>
