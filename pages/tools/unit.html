<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒ¼ãƒ‘ãƒ¼å¤šæ©Ÿèƒ½å˜ä½å¤‰æ›ãƒ„ãƒ¼ãƒ« (åŸºæœ¬å˜ä½å¢—å¼·ç‰ˆ)</title>
    <style>
        /* --- CSSã‚»ã‚¯ã‚·ãƒ§ãƒ³ --- (å‰å›ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å¤‰æ›´ãªã—) */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 40px 20px;
            background-color: #eef2f7;
            color: #333;
        }

        .converter-container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
        }

        h1 {
            text-align: center;
            color: #1a5c92;
            margin-bottom: 30px;
            border-bottom: 3px solid #1a5c92;
            padding-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            padding: 15px;
            background-color: #f7f9fb;
            border-radius: 8px;
        }

        .input-group {
            flex-grow: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }

        /* æ¤œç´¢ã¨ã‚«ãƒ†ã‚´ãƒªé¸æŠã®ãŸã‚ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        .category-search-container {
            position: relative; 
        }

        /* æ¤œç´¢å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
        #categorySearch {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }

        /* ææ¡ˆãƒªã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #categorySuggestions {
            position: absolute;
            z-index: 10;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-top: none;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 0 0 6px 6px;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #categorySuggestions li {
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #categorySuggestions li:hover, #categorySuggestions li.selected {
            background-color: #e0eaff;
            font-weight: bold;
        }
        
        /* å¤‰æ›å…ƒå˜ä½ã¨å€¤ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
        input[type="number"], select {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }

        /* çµæœãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .result-section {
            margin-top: 30px;
        }

        h2 {
            color: #007bff;
            margin-bottom: 15px;
            border-left: 5px solid #007bff;
            padding-left: 10px;
        }

        #resultTable {
            width: 100%;
            border-collapse: collapse;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        #resultTable th, #resultTable td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        #resultTable th {
            background-color: #1a5c92;
            color: white;
            font-weight: 700;
        }
        
        #resultTable th:nth-child(2), #resultTable td:nth-child(2) {
            text-align: right; 
            font-weight: bold;
            color: #0056b3;
        }

        #resultTable tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>

<div class="converter-container">
    <h1>ğŸŒ ã‚¹ãƒ¼ãƒ‘ãƒ¼å¤šæ©Ÿèƒ½å˜ä½å¤‰æ›ãƒ„ãƒ¼ãƒ«</h1>

    <div class="controls">
        <div class="input-group">
            <label for="categorySearch">ã‚«ãƒ†ã‚´ãƒªæ¤œç´¢:</label>
            <div class="category-search-container" id="categorySearchArea">
                <input type="text" id="categorySearch" placeholder="ã‚«ãƒ†ã‚´ãƒªåã‚’å…¥åŠ›ã—ã¦æ¤œç´¢..." autocomplete="off">
                <ul id="categorySuggestions" style="display:none;"></ul>
            </div>
            <input type="hidden" id="selectedCategoryKey" value="">
        </div>

        <div class="input-group">
            <label for="inputValue">å€¤:</label>
            <input type="number" id="inputValue" value="1" placeholder="å¤‰æ›ã—ãŸã„å€¤ã‚’å…¥åŠ›" oninput="convertUnit()">
        </div>

        <div class="input-group">
            <label for="fromUnit">å¤‰æ›å…ƒå˜ä½:</label>
            <select id="fromUnit" onchange="convertUnit()"></select>
        </div>
    </div>

    <div class="result-section">
        <h2 id="resultTitle">çµæœ</h2>
        <table id="resultTable">
            <thead>
                <tr>
                    <th>å˜ä½å</th>
                    <th>æ›ç®—å€¤</th>
                    <th>å˜ä½</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>

</div>

<script>
    // --- JavaScriptã‚»ã‚¯ã‚·ãƒ§ãƒ³ ---

    // å˜ä½ã¨ãã®å¤‰æ›åŸºæº– (åŸºæœ¬å˜ä½ã‚’ã•ã‚‰ã«å¢—å¼·)
    const units = {
        // --- å¹¾ä½•å­¦ ---
        "é•·ã•": { 
            // SI/ãƒ¡ãƒ¼ãƒˆãƒ«æ³• (ãƒ™ãƒ¼ã‚¹: m)
            pm: { name: "ãƒ”ã‚³ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1e-12, system: "SI", display: "pm" },
            nm: { name: "ãƒŠãƒãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1e-9, system: "SI", display: "nm" },
            Î¼m: { name: "ãƒã‚¤ã‚¯ãƒ­ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1e-6, system: "SI", display: "Î¼m" },
            mm: { name: "ãƒŸãƒªãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1e-3, system: "SI", display: "mm" },
            cm: { name: "ã‚»ãƒ³ãƒãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1e-2, system: "SI", display: "cm" },
            m: { name: "ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1, system: "SI", display: "m" },
            km: { name: "ã‚­ãƒ­ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1e3, system: "SI", display: "km" },
            // ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•
            mil: { name: "ãƒŸãƒ«", toBase: 2.54e-5, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "mil" },
            in: { name: "ã‚¤ãƒ³ãƒ", toBase: 0.0254, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "in" },
            ft: { name: "ãƒ•ã‚£ãƒ¼ãƒˆ", toBase: 0.3048, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "ft" },
            yd: { name: "ãƒ¤ãƒ¼ãƒ‰", toBase: 0.9144, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "yd" },
            mi: { name: "ãƒã‚¤ãƒ« (åœŸåœ°)", toBase: 1609.344, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "mi" },
            // å°ºè²«æ³•
            åˆ†: { name: "åˆ†(ãƒ–)", toBase: 0.0030303, system: "å°ºè²«æ³•", display: "åˆ†" },
            å¯¸: { name: "å¯¸(ã‚¹ãƒ³)", toBase: 0.030303, system: "å°ºè²«æ³•", display: "å¯¸" },
            å°º: { name: "å°º(ã‚·ãƒ£ã‚¯)", toBase: 0.30303, system: "å°ºè²«æ³•", display: "å°º" },
            // å¤©æ–‡ãƒ»èˆªæµ·
            æµ·é‡Œ: { name: "æµ·é‡Œ", toBase: 1852, system: "èˆªæµ·", display: "æµ·é‡Œ" },
            AU: { name: "å¤©æ–‡å˜ä½", toBase: 149597870700, system: "å¤©æ–‡", display: "AU" },
            ly: { name: "å…‰å¹´", toBase: 9.46073e15, system: "å¤©æ–‡", display: "ly" },
            pc: { name: "ãƒ‘ãƒ¼ã‚»ã‚¯", toBase: 3.0856776e16, system: "å¤©æ–‡", display: "pc" },
        },
        "é¢ç©": { 
            // SI/ãƒ¡ãƒ¼ãƒˆãƒ«æ³• (ãƒ™ãƒ¼ã‚¹: mÂ²)
            mm2: { name: "å¹³æ–¹ãƒŸãƒªãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1e-6, system: "SI", display: "mmÂ²" },
            cm2: { name: "å¹³æ–¹ã‚»ãƒ³ãƒãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1e-4, system: "SI", display: "cmÂ²" },
            m2: { name: "å¹³æ–¹ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1, system: "SI", display: "mÂ²" },
            a: { name: "ã‚¢ãƒ¼ãƒ«", toBase: 100, system: "SI", display: "a" },
            ha: { name: "ãƒ˜ã‚¯ã‚¿ãƒ¼ãƒ«", toBase: 10000, system: "SI", display: "ha" },
            km2: { name: "å¹³æ–¹ã‚­ãƒ­ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1e6, system: "SI", display: "kmÂ²" },
            // ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•
            ft2: { name: "å¹³æ–¹ãƒ•ã‚£ãƒ¼ãƒˆ", toBase: 0.092903, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "ftÂ²" },
            yd2: { name: "å¹³æ–¹ãƒ¤ãƒ¼ãƒ‰", toBase: 0.836127, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "ydÂ²" },
            ac: { name: "ã‚¨ãƒ¼ã‚«ãƒ¼", toBase: 4046.86, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "ac" },
            mi2: { name: "å¹³æ–¹ãƒã‚¤ãƒ«", toBase: 2589988, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "miÂ²" },
            // å°ºè²«æ³•
            åª: { name: "åª", toBase: 3.305785, system: "å°ºè²«æ³•", display: "åª" },
            å: { name: "å", toBase: 991.7355, system: "å°ºè²«æ³•", display: "å" },
            ç”ºæ­©: { name: "ç”ºæ­©", toBase: 9917.355, system: "å°ºè²«æ³•", display: "ç”ºæ­©" },
        },
        "ä½“ç©": { 
            // SI/ãƒ¡ãƒ¼ãƒˆãƒ«æ³• (ãƒ™ãƒ¼ã‚¹: mÂ³)
            cm3: { name: "ç«‹æ–¹ã‚»ãƒ³ãƒãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1e-6, system: "SI", display: "cmÂ³" },
            mL: { name: "ãƒŸãƒªãƒªãƒƒãƒˆãƒ«", toBase: 1e-6, system: "SI", display: "mL" },
            L: { name: "ãƒªãƒƒãƒˆãƒ«", toBase: 1e-3, system: "SI", display: "L" },
            m3: { name: "ç«‹æ–¹ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1, system: "SI", display: "mÂ³" },
            // ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•
            floz_us: { name: "æ¶²é‡ã‚ªãƒ³ã‚¹ (US)", toBase: 2.95735e-5, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "fl oz (US)" },
            qt_us: { name: "ã‚¯ã‚©ãƒ¼ãƒˆ (USæ¶²é‡)", toBase: 0.000946353, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "qt (US)" },
            gal_us: { name: "ã‚¬ãƒ­ãƒ³ (USæ¶²é‡)", toBase: 0.00378541, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "gal (US)" },
            ft3: { name: "ç«‹æ–¹ãƒ•ã‚£ãƒ¼ãƒˆ", toBase: 0.0283168, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "ftÂ³" },
            yd3: { name: "ç«‹æ–¹ãƒ¤ãƒ¼ãƒ‰", toBase: 0.764555, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "ydÂ³" },
            bbl: { name: "ãƒãƒ¬ãƒ« (çŸ³æ²¹)", toBase: 0.158987, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "bbl" },
            // å°ºè²«æ³•
            åˆ: { name: "åˆ", toBase: 0.000180391, system: "å°ºè²«æ³•", display: "åˆ" },
            å‡: { name: "å‡", toBase: 0.00180391, system: "å°ºè²«æ³•", display: "å‡" },
            çŸ³: { name: "çŸ³", toBase: 0.180391, system: "å°ºè²«æ³•", display: "çŸ³" },
        },
        // --- ç‰©ç†é‡ ---
        "è³ªé‡": { 
            // SI/ãƒ¡ãƒ¼ãƒˆãƒ«æ³• (ãƒ™ãƒ¼ã‚¹: kg)
            Î¼g: { name: "ãƒã‚¤ã‚¯ãƒ­ã‚°ãƒ©ãƒ ", toBase: 1e-9, system: "SI", display: "Î¼g" },
            mg: { name: "ãƒŸãƒªã‚°ãƒ©ãƒ ", toBase: 1e-6, system: "SI", display: "mg" },
            g: { name: "ã‚°ãƒ©ãƒ ", toBase: 1e-3, system: "SI", display: "g" },
            kg: { name: "ã‚­ãƒ­ã‚°ãƒ©ãƒ ", toBase: 1, system: "SI", display: "kg" },
            t: { name: "ãƒˆãƒ³ (metric)", toBase: 1000, system: "SI", display: "t" },
            // ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•
            oz: { name: "ã‚ªãƒ³ã‚¹ (å¸¸è¡¡)", toBase: 0.0283495, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "oz" },
            lb: { name: "ãƒãƒ³ãƒ‰ (å¸¸è¡¡)", toBase: 0.453592, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "lb" },
            st: { name: "ã‚¹ãƒˆãƒ¼ãƒ³", toBase: 6.35029, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "st" },
            ton_us: { name: "ã‚·ãƒ§ãƒ¼ãƒˆãƒˆãƒ³ (US)", toBase: 907.185, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "ton (US)" },
            // å°ºè²«æ³•
            åŒ: { name: "åŒ(ãƒ¢ãƒ³ãƒ¡)", toBase: 0.00375, system: "å°ºè²«æ³•", display: "åŒ" },
            è²«: { name: "è²«", toBase: 3.75, system: "å°ºè²«æ³•", display: "è²«" },
        },
        "æ™‚é–“": { 
            // SI/ãã®ä»– (ãƒ™ãƒ¼ã‚¹: s)
            ns: { name: "ãƒŠãƒç§’", toBase: 1e-9, system: "SI", display: "ns" },
            Î¼s: { name: "ãƒã‚¤ã‚¯ãƒ­ç§’", toBase: 1e-6, system: "SI", display: "Î¼s" },
            ms: { name: "ãƒŸãƒªç§’", toBase: 1e-3, system: "SI", display: "ms" },
            s: { name: "ç§’", toBase: 1, system: "SI", display: "s" },
            min: { name: "åˆ†", toBase: 60, system: "ãã®ä»–", display: "min" },
            hr: { name: "æ™‚", toBase: 3600, system: "ãã®ä»–", display: "h" },
            day: { name: "æ—¥", toBase: 86400, system: "ãã®ä»–", display: "day" },
            week: { name: "é€±", toBase: 604800, system: "ãã®ä»–", display: "week" },
            year: { name: "å¹´ (å¹³å¹´)", toBase: 31536000, system: "ãã®ä»–", display: "year" },
            decade: { name: "ãƒ‡ã‚£ã‚±ãƒ¼ãƒ‰", toBase: 315360000, system: "ãã®ä»–", display: "decade" },
            century: { name: "ä¸–ç´€", toBase: 3153600000, system: "ãã®ä»–", display: "century" },
        },
        "é€Ÿã•": { 
            // SI/ãƒ¡ãƒ¼ãƒˆãƒ«æ³• (ãƒ™ãƒ¼ã‚¹: m/s)
            ms: { name: "ãƒ¡ãƒ¼ãƒˆãƒ«æ¯ç§’", toBase: 1, system: "SI", display: "m/s" },
            cms: { name: "ã‚»ãƒ³ãƒãƒ¡ãƒ¼ãƒˆãƒ«æ¯ç§’", toBase: 0.01, system: "CGS", display: "cm/s" },
            kmh: { name: "ã‚­ãƒ­ãƒ¡ãƒ¼ãƒˆãƒ«æ¯æ™‚", toBase: 1 / 3.6, system: "SI", display: "km/h" },
            // ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•/èˆªæµ·
            fps: { name: "ãƒ•ã‚£ãƒ¼ãƒˆæ¯ç§’", toBase: 0.3048, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "ft/s" },
            mph: { name: "ãƒã‚¤ãƒ«æ¯æ™‚", toBase: 0.44704, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "mph" },
            knot: { name: "ãƒãƒƒãƒˆ", toBase: 0.514444, system: "èˆªæµ·", display: "kn" },
            mach: { name: "ãƒãƒƒãƒ", toBase: 340.29, system: "ãã®ä»–", display: "Mach" }, // 20åº¦Cã§ã®å¤§æ°—ä¸­
        },
        "åŠ›": { 
            // SI/ãã®ä»– (ãƒ™ãƒ¼ã‚¹: N)
            mN: { name: "ãƒŸãƒªãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³", toBase: 1e-3, system: "SI", display: "mN" },
            N: { name: "ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³", toBase: 1, system: "SI", display: "N" },
            kN: { name: "ã‚­ãƒ­ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³", toBase: 1000, system: "SI", display: "kN" },
            MN: { name: "ãƒ¡ã‚¬ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³", toBase: 1e6, system: "SI", display: "MN" },
            dyn: { name: "ãƒ€ã‚¤ãƒ³", toBase: 1e-5, system: "CGS", display: "dyn" },
            kgf: { name: "é‡é‡ã‚­ãƒ­ã‚°ãƒ©ãƒ ", toBase: 9.80665, system: "ãƒ¡ãƒ¼ãƒˆãƒ«æ³•", display: "kgf" },
            lbf: { name: "é‡é‡ãƒãƒ³ãƒ‰", toBase: 4.44822, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "lbf" },
        },
        "ã‚¨ãƒãƒ«ã‚®ãƒ¼": { 
            // SI/ãã®ä»– (ãƒ™ãƒ¼ã‚¹: J)
            mJ: { name: "ãƒŸãƒªã‚¸ãƒ¥ãƒ¼ãƒ«", toBase: 1e-3, system: "SI", display: "mJ" },
            J: { name: "ã‚¸ãƒ¥ãƒ¼ãƒ«", toBase: 1, system: "SI", display: "J" },
            kJ: { name: "ã‚­ãƒ­ã‚¸ãƒ¥ãƒ¼ãƒ«", toBase: 1000, system: "SI", display: "kJ" },
            MJ: { name: "ãƒ¡ã‚¬ã‚¸ãƒ¥ãƒ¼ãƒ«", toBase: 1e6, system: "SI", display: "MJ" },
            erg: { name: "ã‚¨ãƒ«ã‚°", toBase: 1e-7, system: "CGS", display: "erg" },
            cal_it: { name: "ã‚«ãƒ­ãƒªãƒ¼ (IT)", toBase: 4.1868, system: "ãã®ä»–", display: "cal" },
            kcal: { name: "ã‚­ãƒ­ã‚«ãƒ­ãƒªãƒ¼", toBase: 4184, system: "ãã®ä»–", display: "kcal" },
            Btu: { name: "è‹±å›½ç†±é‡å˜ä½", toBase: 1055.06, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "BTU" },
            eV: { name: "é›»å­ãƒœãƒ«ãƒˆ", toBase: 1.60218e-19, system: "ç‰©ç†", display: "eV" },
            kWh: { name: "ã‚­ãƒ­ãƒ¯ãƒƒãƒˆæ™‚", toBase: 3600000, system: "é›»æ°—", display: "kWh" },
        },
        "åœ§åŠ›": { 
            // SI/ãã®ä»– (ãƒ™ãƒ¼ã‚¹: Pa)
            Pa: { name: "ãƒ‘ã‚¹ã‚«ãƒ«", toBase: 1, system: "SI", display: "Pa" },
            hPa: { name: "ãƒ˜ã‚¯ãƒˆãƒ‘ã‚¹ã‚«ãƒ«", toBase: 100, system: "SI", display: "hPa" },
            kPa: { name: "ã‚­ãƒ­ãƒ‘ã‚¹ã‚«ãƒ«", toBase: 1000, system: "SI", display: "kPa" },
            MPa: { name: "ãƒ¡ã‚¬ãƒ‘ã‚¹ã‚«ãƒ«", toBase: 1e6, system: "SI", display: "MPa" },
            bar: { name: "ãƒãƒ¼ãƒ«", toBase: 100000, system: "ãã®ä»–", display: "bar" },
            mbar: { name: "ãƒŸãƒªãƒãƒ¼ãƒ«", toBase: 100, system: "ãã®ä»–", display: "mbar" },
            atm: { name: "æ°—åœ§ (æ¨™æº–)", toBase: 101325, system: "ãã®ä»–", display: "atm" },
            torr: { name: "ãƒˆãƒ«", toBase: 133.322, system: "ãã®ä»–", display: "Torr" },
            psi: { name: "é‡é‡ãƒãƒ³ãƒ‰æ¯å¹³æ–¹ã‚¤ãƒ³ãƒ", toBase: 6894.76, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "psi" },
        },
        "é›»åŠ›": { 
            // SI/ãã®ä»– (ãƒ™ãƒ¼ã‚¹: W)
            mW: { name: "ãƒŸãƒªãƒ¯ãƒƒãƒˆ", toBase: 1e-3, system: "SI", display: "mW" },
            W: { name: "ãƒ¯ãƒƒãƒˆ", toBase: 1, system: "SI", display: "W" },
            kW: { name: "ã‚­ãƒ­ãƒ¯ãƒƒãƒˆ", toBase: 1000, system: "SI", display: "kW" },
            MW: { name: "ãƒ¡ã‚¬ãƒ¯ãƒƒãƒˆ", toBase: 1e6, system: "SI", display: "MW" },
            hp_imp: { name: "é¦¬åŠ› (UK)", toBase: 745.7, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "hp (UK)" },
            hp_met: { name: "é¦¬åŠ› (ãƒ¡ãƒ¼ãƒˆãƒ«æ³•)", toBase: 735.49875, system: "ãƒ¡ãƒ¼ãƒˆãƒ«æ³•", display: "PS" },
        },
        "å¯†åº¦": { 
            // SI/CGS (ãƒ™ãƒ¼ã‚¹: kg/mÂ³)
            kgm3: { name: "ã‚­ãƒ­ã‚°ãƒ©ãƒ æ¯ç«‹æ–¹ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1, system: "SI", display: "kg/mÂ³" },
            gcm3: { name: "ã‚°ãƒ©ãƒ æ¯ç«‹æ–¹ã‚»ãƒ³ãƒãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1000, system: "CGS", display: "g/cmÂ³" },
            lbft3: { name: "ãƒãƒ³ãƒ‰æ¯ç«‹æ–¹ãƒ•ã‚£ãƒ¼ãƒˆ", toBase: 16.0185, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "lb/ftÂ³" },
        },
        "ãƒˆãƒ«ã‚¯": { 
            // SI/ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³• (ãƒ™ãƒ¼ã‚¹: Nâ‹…m)
            mNm: { name: "ãƒŸãƒªãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1e-3, system: "SI", display: "mNâ‹…m" },
            Nm: { name: "ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1, system: "SI", display: "Nâ‹…m" },
            kNm: { name: "ã‚­ãƒ­ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1000, system: "SI", display: "kNâ‹…m" },
            kgf_m: { name: "é‡é‡ã‚­ãƒ­ã‚°ãƒ©ãƒ ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 9.80665, system: "ãƒ¡ãƒ¼ãƒˆãƒ«æ³•", display: "kgfâ‹…m" },
            lbf_ft: { name: "é‡é‡ãƒãƒ³ãƒ‰ãƒ•ã‚£ãƒ¼ãƒˆ", toBase: 1.355818, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "lbfâ‹…ft" },
        },
        // --- æ¸©åº¦ (ç‰¹æ®Šå¤‰æ›) ---
        "æ¸©åº¦": { 
            C: { name: "ã‚»ãƒ«ã‚·ã‚¦ã‚¹åº¦", system: "SI", display: "Â°C" },
            F: { name: "ãƒ•ã‚¡ãƒ¼ãƒ¬ãƒ³ãƒã‚¤ãƒˆåº¦", system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "Â°F" },
            K: { name: "ã‚±ãƒ«ãƒ“ãƒ³", system: "SI", display: "K" },
            R: { name: "ãƒ©ãƒ³ã‚­ãƒ³åº¦", system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "Â°R" },
        },
        // --- é›»æ°—ãƒ»ç£æ°— ---
        "é›»è·": { 
            // SI/é›»æ°— (ãƒ™ãƒ¼ã‚¹: C)
            C: { name: "ã‚¯ãƒ¼ãƒ­ãƒ³", toBase: 1, system: "SI", display: "C" },
            mC: { name: "ãƒŸãƒªã‚¹ã‚¯ãƒ¼ãƒ­ãƒ³", toBase: 1e-3, system: "SI", display: "mC" },
            Ah: { name: "ã‚¢ãƒ³ãƒšã‚¢æ™‚", toBase: 3600, system: "é›»æ°—", display: "Ah" },
        },
        "é›»æµ": { 
            A: { name: "ã‚¢ãƒ³ãƒšã‚¢", toBase: 1, system: "SI", display: "A" },
            mA: { name: "ãƒŸãƒªã‚¢ãƒ³ãƒšã‚¢", toBase: 1e-3, system: "SI", display: "mA" },
            kA: { name: "ã‚­ãƒ­ã‚¢ãƒ³ãƒšã‚¢", toBase: 1000, system: "SI", display: "kA" },
        },
        "é›»åœ§": { 
            V: { name: "ãƒœãƒ«ãƒˆ", toBase: 1, system: "SI", display: "V" },
            mV: { name: "ãƒŸãƒªãƒœãƒ«ãƒˆ", toBase: 1e-3, system: "SI", display: "mV" },
            kV: { name: "ã‚­ãƒ­ãƒœãƒ«ãƒˆ", toBase: 1000, system: "SI", display: "kV" },
        },
        "æŠµæŠ—": { 
            ohm: { name: "ã‚ªãƒ¼ãƒ ", toBase: 1, system: "SI", display: "Î©" },
            mOhm: { name: "ãƒŸãƒªã‚ªãƒ¼ãƒ ", toBase: 1e-3, system: "SI", display: "mÎ©" },
            kOhm: { name: "ã‚­ãƒ­ã‚ªãƒ¼ãƒ ", toBase: 1000, system: "SI", display: "kÎ©" },
            MOhm: { name: "ãƒ¡ã‚¬ã‚ªãƒ¼ãƒ ", toBase: 1e6, system: "SI", display: "MÎ©" },
        },
        "ã‚¤ãƒ³ãƒ€ã‚¯ã‚¿ãƒ³ã‚¹": { 
            H: { name: "ãƒ˜ãƒ³ãƒªãƒ¼", toBase: 1, system: "SI", display: "H" },
            mH: { name: "ãƒŸãƒªãƒ˜ãƒ³ãƒªãƒ¼", toBase: 1e-3, system: "SI", display: "mH" },
            Î¼H: { name: "ãƒã‚¤ã‚¯ãƒ­ãƒ˜ãƒ³ãƒªãƒ¼", toBase: 1e-6, system: "SI", display: "Î¼H" },
        },
        "ç£æŸ": { 
            Wb: { name: "ã‚¦ã‚§ãƒ¼ãƒ", toBase: 1, system: "SI", display: "Wb" },
            mWb: { name: "ãƒŸãƒªã‚¦ã‚§ãƒ¼ãƒ", toBase: 1e-3, system: "SI", display: "mWb" },
            Mx: { name: "ãƒã‚¯ã‚¹ã‚¦ã‚§ãƒ«", toBase: 1e-8, system: "CGS", display: "Mx" },
        },
        "ç£æŸå¯†åº¦": { 
            T: { name: "ãƒ†ã‚¹ãƒ©", toBase: 1, system: "SI", display: "T" },
            mT: { name: "ãƒŸãƒªãƒ†ã‚¹ãƒ©", toBase: 1e-3, system: "SI", display: "mT" },
            Î¼T: { name: "ãƒã‚¤ã‚¯ãƒ­ãƒ†ã‚¹ãƒ©", toBase: 1e-6, system: "SI", display: "Î¼T" },
            G: { name: "ã‚¬ã‚¦ã‚¹", toBase: 1e-4, system: "CGS", display: "G" },
        },
        // --- å…‰ãƒ»æ”¾å°„ç·š ---
        "å…‰åº¦": { 
            cd: { name: "ã‚«ãƒ³ãƒ‡ãƒ©", toBase: 1, system: "SI", display: "cd" },
            kcd: { name: "ã‚­ãƒ­ã‚«ãƒ³ãƒ‡ãƒ©", toBase: 1000, system: "SI", display: "kcd" },
        },
        "ç…§åº¦": { 
            lx: { name: "ãƒ«ã‚¯ã‚¹", toBase: 1, system: "SI", display: "lx" },
            klx: { name: "ã‚­ãƒ«ãƒ«ã‚¯ã‚¹", toBase: 1000, system: "SI", display: "klx" },
            foot_candle: { name: "ãƒ•ãƒ¼ãƒˆãƒ»ã‚«ãƒ³ãƒ‡ãƒ©", toBase: 10.76391, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "fc" },
        },
        "æ”¾å°„èƒ½": { 
            Bq: { name: "ãƒ™ã‚¯ãƒ¬ãƒ«", toBase: 1, system: "SI", display: "Bq" },
            kBq: { name: "ã‚­ãƒ­ãƒ™ã‚¯ãƒ¬ãƒ«", toBase: 1000, system: "SI", display: "kBq" },
            MBq: { name: "ãƒ¡ã‚¬ãƒ™ã‚¯ãƒ¬ãƒ«", toBase: 1e6, system: "SI", display: "MBq" },
            Ci: { name: "ã‚­ãƒ¥ãƒªãƒ¼", toBase: 3.7e10, system: "ãã®ä»–", display: "Ci" },
        },
        // --- ãƒ‡ãƒ¼ã‚¿ãƒ»æ¿ƒåº¦ãƒ»æµé‡ ---
        "ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º(JEDEC)": { 
            bit: { name: "ãƒ“ãƒƒãƒˆ", toBase: 1 / 8, system: "JEDEC", display: "bit" },
            B: { name: "ãƒã‚¤ãƒˆ", toBase: 1, system: "JEDEC", display: "B" },
            KB: { name: "ã‚­ãƒ­ãƒã‚¤ãƒˆ", toBase: 1024, system: "JEDEC", display: "KB" },
            MB: { name: "ãƒ¡ã‚¬ãƒã‚¤ãƒˆ", toBase: 1024 ** 2, system: "JEDEC", display: "MB" },
            GB: { name: "ã‚®ã‚¬ãƒã‚¤ãƒˆ", toBase: 1024 ** 3, system: "JEDEC", display: "GB" },
            TB: { name: "ãƒ†ãƒ©ãƒã‚¤ãƒˆ", toBase: 1024 ** 4, system: "JEDEC", display: "TB" },
            PB: { name: "ãƒšã‚¿ãƒã‚¤ãƒˆ", toBase: 1024 ** 5, system: "JEDEC", display: "PB" },
        },
        "æµé‡(ä½“ç©)": { 
            m3s: { name: "ç«‹æ–¹ãƒ¡ãƒ¼ãƒˆãƒ«æ¯ç§’", toBase: 1, system: "SI", display: "mÂ³/s" },
            Lmin: { name: "ãƒªãƒƒãƒˆãƒ«æ¯åˆ†", toBase: 1e-3 / 60, system: "SI", display: "L/min" },
            ft3s: { name: "ç«‹æ–¹ãƒ•ã‚£ãƒ¼ãƒˆæ¯ç§’", toBase: 0.0283168, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "ftÂ³/s" },
            galmin: { name: "ã‚¬ãƒ­ãƒ³æ¯åˆ† (US)", toBase: 0.00378541 / 60, system: "ãƒ¤ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ãƒ‰æ³•", display: "gal/min" },
        },
        "ãƒ¢ãƒ«æ¿ƒåº¦": { 
            molm3: { name: "ãƒ¢ãƒ«æ¯ç«‹æ–¹ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1, system: "SI", display: "mol/mÂ³" },
            molL: { name: "ãƒ¢ãƒ«æ¯ãƒªãƒƒãƒˆãƒ«", toBase: 1000, system: "SI", display: "mol/L" },
            M: { name: "ãƒ¢ãƒ«æ¿ƒåº¦", toBase: 1000, system: "SI", display: "M" },
            mM: { name: "ãƒŸãƒªãƒ¢ãƒ«æ¿ƒåº¦", toBase: 1, system: "SI", display: "mM" },
        },
        // --- ãã®ä»–åŸºç¤å˜ä½ ---
        "è§’åº¦": { 
            rad: { name: "ãƒ©ã‚¸ã‚¢ãƒ³", toBase: 1, system: "SI", display: "rad" },
            mrad: { name: "ãƒŸãƒªãƒ©ã‚¸ã‚¢ãƒ³", toBase: 1e-3, system: "SI", display: "mrad" },
            deg: { name: "åº¦", toBase: Math.PI / 180, system: "ãã®ä»–", display: "Â°" },
            grad: { name: "ã‚°ãƒ©ã‚¸ã‚¢ãƒ³", toBase: Math.PI / 200, system: "ãã®ä»–", display: "grad" },
            arcsec: { name: "ç§’ (è§’)", toBase: Math.PI / 648000, system: "ãã®ä»–", display: "''" },
        },
        "å‘¨æ³¢æ•°": { 
            Hz: { name: "ãƒ˜ãƒ«ãƒ„", toBase: 1, system: "SI", display: "Hz" },
            kHz: { name: "ã‚­ãƒ­ãƒ˜ãƒ«ãƒ„", toBase: 1000, system: "SI", display: "kHz" },
            MHz: { name: "ãƒ¡ã‚¬ãƒ˜ãƒ«ãƒ„", toBase: 1e6, system: "SI", display: "MHz" },
            GHz: { name: "ã‚®ã‚¬ãƒ˜ãƒ«ãƒ„", toBase: 1e9, system: "SI", display: "GHz" },
        },
        "ç‰©è³ªé‡": { 
            mol: { name: "ãƒ¢ãƒ«", toBase: 1, system: "SI", display: "mol" },
            kmol: { name: "ã‚­ãƒ­ãƒ¢ãƒ«", toBase: 1000, system: "SI", display: "kmol" },
            mmol: { name: "ãƒŸãƒªãƒ¢ãƒ«", toBase: 1e-3, system: "SI", display: "mmol" },
        },
        "å‹•ç²˜åº¦": { 
            Pas: { name: "ãƒ‘ã‚¹ã‚«ãƒ«ç§’", toBase: 1, system: "SI", display: "Paâ‹…s" },
            mPas: { name: "ãƒŸãƒªãƒ‘ã‚¹ã‚«ãƒ«ç§’", toBase: 1e-3, system: "SI", display: "mPaâ‹…s" },
            poise: { name: "ãƒã‚¢ã‚º", toBase: 0.1, system: "CGS", display: "P" },
            cP: { name: "ã‚»ãƒ³ãƒãƒã‚¢ã‚º", toBase: 0.001, system: "CGS", display: "cP" },
        },
        "è¡¨é¢å¼µåŠ›": { 
            Nm: { name: "ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ¯ãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1, system: "SI", display: "N/m" },
            dyn_cm: { name: "ãƒ€ã‚¤ãƒ³æ¯ã‚»ãƒ³ãƒãƒ¡ãƒ¼ãƒˆãƒ«", toBase: 1e-3, system: "CGS", display: "dyn/cm" },
        },
        "é‹å‹•é‡": { 
            kgms: { name: "ã‚­ãƒ­ã‚°ãƒ©ãƒ ãƒ¡ãƒ¼ãƒˆãƒ«æ¯ç§’", toBase: 1, system: "SI", display: "kgâ‹…m/s" },
            gs: { name: "ã‚°ãƒ©ãƒ ã‚»ãƒ³ãƒãƒ¡ãƒ¼ãƒˆãƒ«æ¯ç§’", toBase: 1e-5, system: "CGS", display: "gâ‹…cm/s" },
        },
        "ã‚¤ãƒ³ãƒ”ãƒ¼ãƒ€ãƒ³ã‚¹": { 
            ohm: { name: "ã‚ªãƒ¼ãƒ ", toBase: 1, system: "SI", display: "Î©" },
            mOhm: { name: "ãƒŸãƒªã‚ªãƒ¼ãƒ ", toBase: 1e-3, system: "SI", display: "mÎ©" },
        },
        "ã‚³ãƒ³ãƒ€ã‚¯ã‚¿ãƒ³ã‚¹": { 
            S: { name: "ã‚¸ãƒ¼ãƒ¡ãƒ³ã‚¹", toBase: 1, system: "SI", display: "S" },
            mS: { name: "ãƒŸãƒªã‚¸ãƒ¼ãƒ¡ãƒ³ã‚¹", toBase: 1e-3, system: "SI", display: "mS" },
            kS: { name: "ã‚­ãƒ­ã‚¸ãƒ¼ãƒ¡ãƒ³ã‚¹", toBase: 1000, system: "SI", display: "kS" },
        },
        "é™é›»å®¹é‡": { 
            F: { name: "ãƒ•ã‚¡ãƒ©ãƒ‰", toBase: 1, system: "SI", display: "F" },
            Î¼F: { name: "ãƒã‚¤ã‚¯ãƒ­ãƒ•ã‚¡ãƒ©ãƒ‰", toBase: 1e-6, system: "SI", display: "Î¼F" },
            nF: { name: "ãƒŠãƒãƒ•ã‚¡ãƒ©ãƒ‰", toBase: 1e-9, system: "SI", display: "nF" },
            pF: { name: "ãƒ”ã‚³ãƒ•ã‚¡ãƒ©ãƒ‰", toBase: 1e-12, system: "SI", display: "pF" },
        },
    };

    const categorySearch = document.getElementById('categorySearch');
    const categorySuggestions = document.getElementById('categorySuggestions');
    const selectedCategoryKey = document.getElementById('selectedCategoryKey');
    const fromUnitSelect = document.getElementById('fromUnit');
    const inputValue = document.getElementById('inputValue');
    const resultTableBody = document.querySelector('#resultTable tbody');
    const resultTitle = document.getElementById('resultTitle');
    const categorySearchArea = document.getElementById('categorySearchArea');

    const allCategories = Object.keys(units);
    let currentSelectedSuggestionIndex = -1; 

    // ----------------------------------------------------
    // 1. iPad/ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹æœ€é©åŒ–: ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ é˜²æ­¢
    // ----------------------------------------------------
    document.addEventListener('dblclick', function(e) {
      e.preventDefault();
    }, { passive: false });
    
    // ----------------------------------------------------
    // 2. UIåˆ¶å¾¡é–¢æ•°
    // ----------------------------------------------------

    function showSuggestions(list) {
        categorySuggestions.innerHTML = '';
        currentSelectedSuggestionIndex = -1;
        
        if (list.length === 0) {
            categorySuggestions.style.display = 'none';
            return;
        }

        list.forEach((categoryKey, index) => {
            const li = document.createElement('li');
            li.textContent = categoryKey;
            li.dataset.categoryKey = categoryKey;
            
            li.addEventListener('click', (e) => {
                e.stopPropagation(); 
                selectCategory(categoryKey);
            });
            
            categorySuggestions.appendChild(li);
        });
        
        categorySuggestions.style.display = 'block';
    }

    function selectCategory(categoryKey) {
        categorySearch.value = categoryKey; 
        selectedCategoryKey.value = categoryKey; 
        categorySuggestions.style.display = 'none';
        resetConversion(); 
    }
    
    // ----------------------------------------------------
    // 3. ã‚«ãƒ†ã‚´ãƒªæ¤œç´¢/ãƒªã‚¹ãƒˆåˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯
    // ----------------------------------------------------

    categorySearch.addEventListener('input', () => {
        const filterText = categorySearch.value.toLowerCase();
        const filtered = allCategories.filter(key => key.toLowerCase().includes(filterText));
        showSuggestions(filtered);
    });

    categorySearch.addEventListener('focus', () => {
         const filterText = categorySearch.value.toLowerCase();
         const filtered = allCategories.filter(key => key.toLowerCase().includes(filterText));
         showSuggestions(filtered);
    });
    
    // å¤–éƒ¨ã‚¿ãƒƒãƒ—ã§ãƒªã‚¹ãƒˆã‚’é–‰ã˜ã‚‹
    document.addEventListener('click', function(e) {
        const isClickInside = categorySearchArea.contains(e.target);
        const isListOpen = categorySuggestions.style.display !== 'none';

        if (!isClickInside && isListOpen) {
            categorySuggestions.style.display = 'none';
        }
    });

    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®ã‚µãƒãƒ¼ãƒˆ
    categorySearch.addEventListener('keydown', (e) => {
        const items = Array.from(categorySuggestions.children);
        if (items.length === 0) return;

        if (e.key === 'ArrowDown') {
            e.preventDefault();
            currentSelectedSuggestionIndex = (currentSelectedSuggestionIndex + 1) % items.length;
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            currentSelectedSuggestionIndex = (currentSelectedSuggestionIndex - 1 + items.length) % items.length;
        } else if (e.key === 'Enter') {
            e.preventDefault();
            const targetIndex = currentSelectedSuggestionIndex !== -1 ? currentSelectedSuggestionIndex : 0; 
            if (items[targetIndex]) {
                const selectedKey = items[targetIndex].dataset.categoryKey;
                selectCategory(selectedKey);
                categorySearch.blur(); 
            }
            return;
        } else {
            return;
        }

        items.forEach((item, index) => {
            item.classList.toggle('selected', index === currentSelectedSuggestionIndex);
            if (index === currentSelectedSuggestionIndex) {
                 item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        });
    });


    // ----------------------------------------------------
    // 4. å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯
    // ----------------------------------------------------

    function getGroupedUnits(type) {
        const currentUnits = units[type];
        const grouped = {};
        for (const key in currentUnits) {
            const unit = currentUnits[key];
            const system = unit.system || "ãã®ä»–";
            if (!grouped[system]) {
                grouped[system] = [];
            }
            grouped[system].push({ key: key, name: unit.name, display: unit.display });
        }
        return grouped;
    }

    function populateUnits() {
        const type = selectedCategoryKey.value;
        const currentUnits = units[type];

        fromUnitSelect.innerHTML = '';
        if (!currentUnits) {
             fromUnitSelect.innerHTML = '<option value="">å˜ä½ã‚’é¸æŠ</option>';
             return;
        }

        for (const key in currentUnits) {
            const unit = currentUnits[key];
            const option = `<option value="${key}">${unit.name} (${unit.display || key})</option>`;
            fromUnitSelect.insertAdjacentHTML('beforeend', option);
        }

        fromUnitSelect.value = Object.keys(currentUnits)[0];
    }

    function convertTemperature(value, fromKey, toKey) {
        let baseC; 
        if (fromKey === 'C') baseC = value;
        else if (fromKey === 'F') baseC = (value - 32) * 5 / 9;
        else if (fromKey === 'K') baseC = value - 273.15;
        else if (fromKey === 'R') baseC = (value - 491.67) * 5 / 9;

        if (toKey === 'C') return baseC;
        else if (toKey === 'F') return (baseC * 9 / 5) + 32;
        else if (toKey === 'K') return baseC + 273.15;
        else if (toKey === 'R') return (baseC + 273.15) * 9 / 5;
    }

    function convertUnit() {
        const type = selectedCategoryKey.value;
        const value = parseFloat(inputValue.value);
        const fromUnitKey = fromUnitSelect.value;
        const currentUnits = units[type];

        if (isNaN(value) || !type || !currentUnits || !currentUnits[fromUnitKey]) {
            resultTableBody.innerHTML = `<tr><td colspan="3" style="text-align:center; color:red;">å¤‰æ›ã‚’è¡Œã†ã«ã¯ã€ã‚«ãƒ†ã‚´ãƒªã¨æœ‰åŠ¹ãªå˜ä½ã‚’é¸æŠã—ã€å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</td></tr>`;
            resultTitle.textContent = `å¤‰æ›çµæœ`;
            return;
        }

        resultTableBody.innerHTML = ''; 
        resultTitle.textContent = `${value} ${currentUnits[fromUnitKey].name} (${currentUnits[fromUnitKey].display || fromUnitKey}) ã®å¤‰æ›çµæœ`;
        
        const groupedUnits = getGroupedUnits(type);
        
        for (const system in groupedUnits) {
            // å˜ä½ç³»ã®åå‰ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«è¡¨ç¤º
            resultTableBody.insertAdjacentHTML('beforeend', 
                `<tr><td colspan="3" style="background-color:#e0eaff; font-weight:bold; border-top:2px solid #1a5c92;">${system}</td></tr>`
            );

            for (const unit of groupedUnits[system]) {
                const toUnitKey = unit.key;
                let result;

                if (type === 'æ¸©åº¦') {
                    result = convertTemperature(value, fromUnitKey, toUnitKey);
                } else {
                    const baseValue = value * currentUnits[fromUnitKey].toBase;
                    result = baseValue / currentUnits[toUnitKey].toBase;
                }

                // çµæœã®ç²¾åº¦èª¿æ•´
                let displayResult;
                if (result === 0) {
                    displayResult = 0;
                } else {
                    const absResult = Math.abs(result);
                    // éå¸¸ã«å¤§ãã„ã€ã¾ãŸã¯éå¸¸ã«å°ã•ã„å€¤ã¯æŒ‡æ•°è¡¨è¨˜
                    if (absResult > 1e12 || (absResult < 1e-6 && absResult !== 0)) {
                        displayResult = result.toExponential(4);
                    } 
                    // ã»ã¼æ•´æ•°ã®å ´åˆã¯å››æ¨äº”å…¥ã—ã¦æ•´æ•°è¡¨ç¤º
                    else if (Math.abs(result - Math.round(result)) < 1e-8) {
                        displayResult = Math.round(result);
                    } 
                    // ãã‚Œä»¥å¤–ã¯å°æ•°ç‚¹ä»¥ä¸‹6æ¡è¡¨ç¤º
                    else {
                        displayResult = result.toFixed(6);
                    }
                }
                
                const unitDisplay = (unit.display || toUnitKey);
                
                const unitInfo = currentUnits[toUnitKey];
                const resultRow = `
                    <tr>
                        <td>${unitInfo.name}</td>
                        <td>${displayResult}</td>
                        <td>${unitDisplay}</td>
                    </tr>
                `;
                resultTableBody.insertAdjacentHTML('beforeend', resultRow);
            }
        }
    }

    function resetConversion() {
        populateUnits();
        convertUnit();
    }

    // åˆæœŸåŒ–å‡¦ç†
    document.addEventListener('DOMContentLoaded', () => {
        // åˆæœŸçŠ¶æ…‹ã¯ã‚«ãƒ†ã‚´ãƒªæœªé¸æŠã€æœªå…¥åŠ›
        categorySearch.value = ""; 
        selectedCategoryKey.value = "";
        
        convertUnit(); 
    });

</script>

</body>
</html>
